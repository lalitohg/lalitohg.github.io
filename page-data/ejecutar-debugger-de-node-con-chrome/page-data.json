{"componentChunkName":"component---src-templates-blog-post-js","path":"/ejecutar-debugger-de-node-con-chrome","result":{"data":{"post":{"excerpt":"Usar Docker para desarrollar una aplicación Node es cada vez más común. Sin embargo, eso complica un poco la ejecución del debugger que está…","html":"<p>Usar Docker para desarrollar una aplicación Node es cada vez más común. Sin embargo, eso complica un poco la ejecución del debugger que está configurado de forma predeterminada para funcionar en un ambiente completamente local.</p>\n<p>Ahora voy a mostrar como podemos ejecutar el debugger de Node y seguir la ejecución de una aplicación que corre desde un contenedor Docker usando solamente las herramientas incluidas en el navegador Chrome.</p>\n<h2>Antes de iniciar</h2>\n<p>Primero hay que asegurarse de que tenemos una imagen de <strong>Node</strong> para iniciar contenedores basados en ella. Si aún no tienes una imagen de <strong>Node</strong> puedes cargar una con el comando: <code class=\"language-text\">docker pull node</code>.</p>\n<p>Empecemos con una aplicación sencilla que solamente muestre un mensaje en la consola cuando el programa inicia y que después hace la suma de 1+1 guardando el resultado en una contante para finalmente mostrar el resultado de la suma en consola.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// index.js</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"El script ha iniciado\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">debugger</span>\n<span class=\"token keyword\">const</span>  a <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">El resultado final es: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>a<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Es un script sencillo pero suficiente para ilustrar el punto. Ahora vamos a arrancar el contenedor que ejecutará este script.</p>\n<p>Primero debemos abrir una terminal y cambiarnos al directorio donde está guardado el script.</p>\n<blockquote>\n<p>Si estás intentado seguir estos pasos desde una computadora con Linux o MacOS tal vez quieras modificar los permisos del script antes de continuar. Debería funcionar con algo como <code class=\"language-text\">chmod 777 index.js</code></p>\n</blockquote>\n<h2>Ejecutar el debugger de node desde Docker</h2>\n<p>Ahora iniciamos el contenedor con el siguiente comando: <code class=\"language-text\">docker run --rm -it --name test -v C:\\Users\\lalo\\debugger:/usr/src/app -w /usr/src/app -p 9229:9229 node node --inspect-brk=0.0.0.0:9229 index.js</code></p>\n<p>Veamos que hace cada modificador del comando:</p>\n<ul>\n<li><strong>docker run</strong>. Iniciamos un nuevo contenedor</li>\n<li><strong>--rm</strong>. El contenedor será eliminado al terminar la ejecución del proceso</li>\n<li><strong>-it</strong>. El proceso va a interactuar con nuestra terminal recibiendo y enviando texto</li>\n<li><strong>--name test</strong>. El contenedor tendrá un nombre para poder identificarlo entre los demás procesos que ejecute Docker. Si no usamos este modificador Docker le asignará un nombre aleatorio</li>\n<li><strong>-v C:\\Users\\lalo\\debugger:/usr/src/app</strong>. Con esto <em>montamos</em> el folder local de nuestra computadora en el directorio <strong>/usr/src/app</strong> del contenedor que estamos creando. Tendrás que reemplazar <strong>C:\\Users\\lalo\\debugger</strong> por la ruta que aplique en tu caso</li>\n<li><strong>-w /usr/src/app</strong>. Cambiamos el directorio de trabajo dentro del contedor a <strong>/usr/src/app</strong> (es donde la imagen de Node ejecuta los scripts de forma predeterminada). Es como si una vez iniciado el contenedor ejecutaramos <code class=\"language-text\">cd /usr/src/app</code></li>\n<li><strong>-p 9229:9229</strong>. Dirigimos el tráfico del puerto 9229 de nuestra computadora al puerto 9229 dentro del contenedor que estamos creando. Lo necesitamos porque es el puerto que usará el debugger para establecer conexiones remotas</li>\n<li><strong>node node --inspect-brk=0.0.0.0:9229 index.js</strong>. El primer <em>node</em> es el nombre de la imagen que usaremos. Si tienes varias imagenes de Node puedes especificar la versión con algo como <em>node:13.7.0</em> por ejemplo. El resto es el comando que queremos ejecutar dentro del contenedor. En este caso vamos a ejecutar <em>node --inspect-brk=0.0.0.0:9229 index.js</em> (detalles de esto más adelante )</li>\n</ul>\n<p>Si todo sale bien deberías ver que Docker empieza a crear el contenedor y ejecuta el script de prueba en modo debugger.</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">Debugger listening on ws://0.0.0.0:9229/271b253c-2b67-4b69-802d-d0820ab8c49a\nFor help, see: https://nodejs.org/en/docs/inspector</code></pre></div>\n<p>El proceso se va a quedar congelado ahí hasta que iniciemos algún cliente de debugger y reanudemos la ejecución del script.</p>\n<h2>Conectar las herramientas de desarrollo de chrome al contenedor</h2>\n<p>Ahora podemos iniciar el navegador chrome y  abrir la siguiente URL: chrome://inspect/</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 504px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/09e9f987f279c6b93c7cb2e5453a4c47/929d9/node-debugger-docker-chrome-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.78571428571428%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABHElEQVQoz51S7W6EIBD0/V+yl97ZVj0FQZBP59jtYa0/rkknmbhZYZhlaFJKCCEwqSbQ13vPvZwztm3bWXHsHdkopTDeR/RdB6U0LzbLgo/PL3SlF0LEEWfhMxrnHMZxZEcVMUZYa7GuK2yhKTWRxKtgShHzPENKCSEE16HsY0Fq0mgVJDRNE7TWUIWSNhZ6H/Y1dB1t2zKv71f+umKqIWc0Nrmqo9RDqK/U/HQgMdwHFqqCt/aGy+UNfT/8jEw/rDUsUgVDzBiEx104dJMr9TdH6TApD6EDryUTlXso3jsYY1mojp3zBhdK0iEXJj7gzGM4v1KmkemulpKsLjze5Sucn8s+MtnlNClJY9jdq3f2F3eH5Cw9H3EV/A8eVBEQXyAH74cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\" \"\n        title=\" \"\n        src=\"/static/09e9f987f279c6b93c7cb2e5453a4c47/929d9/node-debugger-docker-chrome-1.png\"\n        srcset=\"/static/09e9f987f279c6b93c7cb2e5453a4c47/fc8b9/node-debugger-docker-chrome-1.png 163w,\n/static/09e9f987f279c6b93c7cb2e5453a4c47/d53b1/node-debugger-docker-chrome-1.png 325w,\n/static/09e9f987f279c6b93c7cb2e5453a4c47/929d9/node-debugger-docker-chrome-1.png 504w\"\n        sizes=\"(max-width: 504px) 100vw, 504px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Hay que asegurarse de que tenemos dada de alta una dirección que apunte a algún proceso en modo debugger y esperar pacientemente a que chrome se conecte ya que no muestra algún indicador que nos haga saber que está trabajando en hacer la conexión.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 301px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/34eb9693c401e60cb6fcd13ca3794978/04489/node-debugger-docker-chrome-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 109.96677740863787%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACUElEQVQ4y9VV27aiMAz1/7/qfMGsNUdlwAsKyFVaQO4g7EmLOIKeufg2WWtT0pLdNEnDIk1TlGWJoijumOuv5vM8n+ByuSBJEiyqqkTbtqirCk1To24aaSDmGnoX6LoOdV1Lw/qmz0U4FkWRIKwQ+AFURcF6tYRlOzQqME0D+kHHdruH7zrQ1A122gar9Rqe70sSQdz3vYQQseFCPEYZFx5FGF2vV7Eq9bZtSB+IxNqIO2FRFmiqGvp2h+/KJ1RVxX6jYbn8hHmyx60mnoybP2LioZgQcUvz7B78LMsgwvHKeI6ph0RwbVqYhwNW2gr73RaGvoWirGFaFv5FJGFJR06zAkfLw8kNcXJCuEEEx2fwwwQ8KcDiHGeeIoymOPMMjMcIw5DIhnJa1HUFw2YDoeNjp5uwnQBewKAfbRimA9sLUTU9yvo6RQt8W27w8fGBw+EoS2tRUbzE7pYbkYecyENYDsPJ4zDJW5N024/hs4yQzpBDN2xsNE16KWJ/L5tOBngoDjmO7ze96/oX6J5j+KsO+9k4vve/TcRTlkfCP5XGV3i8EP8Z4TvyeJ8fCnu4Zp7rytRzakHh+Yw4poKlLsQ5g+t6YKEYXZxpzaN5x3FkmTx5KPqgHwTYqBos08KJGsLJMnE8GjANA3ESE3lC/S5DRj3vQk2U8Qie56GVXWhGKHYRH3P6SHgVk4dxRN6dQ0n2N8d+imFJdzDw6ViMo7gd425wi9Fg2E164Dw5InSDh/Q/0FQFP6gXJsnl7STJ5iATwbn8Hwgwxt6C4BAJ+wkpc6oVsCMCJQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"node debugger docker chrome 2\"\n        title=\"node debugger docker chrome 2\"\n        src=\"/static/34eb9693c401e60cb6fcd13ca3794978/04489/node-debugger-docker-chrome-2.png\"\n        srcset=\"/static/34eb9693c401e60cb6fcd13ca3794978/fc8b9/node-debugger-docker-chrome-2.png 163w,\n/static/34eb9693c401e60cb6fcd13ca3794978/04489/node-debugger-docker-chrome-2.png 301w\"\n        sizes=\"(max-width: 301px) 100vw, 301px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Una vez que se ha establecido la conexión solamente tenemos que seguir el enlace que abrirá las DevTools de chrome con nuestro script cargado y listo para ser inspeccionado.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 491px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d77f34d40d0db8293300d0c1416b69cd/a12be/node-debugger-docker-chrome-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.61914460285132%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABf0lEQVQoz41S7XKDMAzj/V9xawe0KwwokA8SCATNNoPjtv6Y73QGExxZclLXNZq6QVmU8N6Do21b3D8fKMoSU5iktq4r/hPJMAwwxmAcR8QYpRhCANe5tiyL1LlhjKvkHfyNca4lXdeiqio5vIdzDr1SAq012r5HQ6z5oo0tMM8z8izHLc+Rph94e79AaYWEWfDH81iO2CnVEXpqqCQz+HJmxMG5KApqmlHe5IprROK8gyEWzvmj4TgFYmU3qEFyR7lpNawL8FPEQjIw++fzScz0IVfi3KbVOQIRVpZ+cCs6s0hWA70TlJ2pFl6aJBoyVUdgfaZpc5RN0rqHtZqelYztaZK4BBqVddxNigcOU/jg1kALOBSZUdE61U2DhkbK8hsZpGUS70nzHx1fro0nR9lVPryPbrTB5Zrii9znxhU1fhXndTkx9Meoe9y7DOnjir6jcY2VnRzoUs7WWhhr/mzGwfD3bWLKMqHuDPIHLfw0y4rM8yJNWOtAeXf1d8NvHepZn5NiWBEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"node debugger docker chrome 3\"\n        title=\"node debugger docker chrome 3\"\n        src=\"/static/d77f34d40d0db8293300d0c1416b69cd/a12be/node-debugger-docker-chrome-3.png\"\n        srcset=\"/static/d77f34d40d0db8293300d0c1416b69cd/fc8b9/node-debugger-docker-chrome-3.png 163w,\n/static/d77f34d40d0db8293300d0c1416b69cd/d53b1/node-debugger-docker-chrome-3.png 325w,\n/static/d77f34d40d0db8293300d0c1416b69cd/a12be/node-debugger-docker-chrome-3.png 491w\"\n        sizes=\"(max-width: 491px) 100vw, 491px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Hay que recordar que una vez que se abre la ventana de desarrollo de chrome tenemos que presionar el botón para reanudar la ejecución del script ya que el interprete se detiene antes de comenzar a ejecutar nuestro código.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 632px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0fa1704497feb956abc006085e372c85/8dee7/node-debugger-docker-chrome-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.13924050632912%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC+klEQVQ4y3VUaVPbMBT0//9Z/dKZFkqBljghkOD7kA/Zko+EZLtPDkzp4cwbybK02rdvX7zr2xtc3a5wfb/B1Z2P69/i248NvvLbl5sH9+3qbo1v98ua7P/5GMB/jnC/3uFhG+KH/wxvv39GmiRI0wxhGCGIUmyfA0Rxiv3+BXleoiwrhkIhUSjOSyjOlapQVc1lrBEEIbzHXQh/GyDJSsRRhDirkJQd6kYjyzLUdUmghAdyNze2Q8YLEgJ3fYvBGljbYxwsLyvgBWTyEpEdRwFIkxhNU0NrzU0D0lLDDwo8RTUPjCjyEXE6MgPr3s14gmWMM/D0tINXKcUbDPq+Y/Touu49DocJ/s8Cnz/luFt18B8tNtuBkozYbg1HgjZnKH1G1QG39yt4oo2xFsaYD9F3PaZpwkBg0zSwXYsTU4PhSauB0bg4cO18eoU8a98XwJLaSDoUX4nQS7RtS4YHnN0POJ/f4vxHLGvyrFYXwLLMnXZRFLoKNmQkGjrA0+kfIH+HY7heL4BxrhGmDVrN9ExPLc1Fw8P75rfxbf4vQFdlpZhy20PVmiC9K8wC2mOeJ5wuDH8H+t+T5zm8rKgckDDSZNjQf4ombZrWGXYxc8HNGVpKIXJE9GtIE4dh6OZBEDjLyUhj7xDHe5R5gDx7QV2liMInarqH6WtWu0SnG2x2CUKav6oq6Fa/W0uKJ2GYkUs5Dr4jDm5QpA9oyg1GG+M4ZZjHFPOQ4nXOaGZpQbYczT3ZCSPtNFPfw/H4IWWxmxcmigwTWqaiZgcX0zy7UYpj7eB6XFOC+qVBldJi1KpME2gWVFcKEx3xSoYt7ec1pCs+lI7pOrHKkWCzq7Cl4Y9kEccxrKH5lYGKK4zU+kgtJxZ0JtCRLSqGdAx76mC5IIcFWEQf+D6Oo1sT4IJMOuqmVcdMCvd9qfrpQ8qiqfcmrBh5GMbF1N3S17K+2Gd27KUd/2cbuSQT20jV0nT5p+l42KVfLUylBZtLFaWvX9mzIsGfIVmIX4XUL9J7WIqrX6ixAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"node debugger docker chrome 4\"\n        title=\"node debugger docker chrome 4\"\n        src=\"/static/0fa1704497feb956abc006085e372c85/8dee7/node-debugger-docker-chrome-4.png\"\n        srcset=\"/static/0fa1704497feb956abc006085e372c85/fc8b9/node-debugger-docker-chrome-4.png 163w,\n/static/0fa1704497feb956abc006085e372c85/d53b1/node-debugger-docker-chrome-4.png 325w,\n/static/0fa1704497feb956abc006085e372c85/8dee7/node-debugger-docker-chrome-4.png 632w\"\n        sizes=\"(max-width: 632px) 100vw, 632px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Al reanudar la ejecución podemos ver que el primer mensaje ha sido desplegado con éxito en la consola y que el interprete se ha detenido en el punto de paro que hemos establecido. </p>\n<p>Podemos usar las herramientas de chrome como sea necesario y reanudar la ejecución de nuestro programa cuando hayamos terminado.</p>\n<h2>¿Cómo se usa el debugger de Node con Docker?</h2>\n<p>Ahora voy a explicar con más detalle como funciona la configuración del debbuger.</p>\n<p>Para indicarle a node que queremos ejecutar nuestro script con capacidad de debugger agregamos la opcion <strong>--inspect-brk</strong>. Con esto activamos el debugger y hacemos que la ejecución se detenga antes de empezar a interpretar nuestro programa hasta que reanudamos la ejecución manualmente desde el cliente de debugger.</p>\n<p>Esto es necesario cuando ejecutamos programas que terminan el proceso inmediatamente después de interpretar todo nuestro código, de lo contrario el programa iniciaría y terminaría mucho antes de que chrome tuviera oportunidad de conectarse al debugger.</p>\n<p>Si estamos ejecutando un programa de ejecución continua como por ejemplo una API hecha con Express, entonces tal vez no es necesario usar <em>--inspect-brk</em> sino la opción <strong>--inspect</strong>, que es prácticamente igual con la diferencia de que no va a detener el proceso al inicio sino hasta que encuentre el primer punto de paro en nuestro código. Esto depende mucho de como funcione tu programa y en que punto de la ejecución te interese hacer una pausa; recuerda que chrome necesita mucho tiempo para poder conectarse al proceso de debugger.</p>\n<p>Tanto <em>--inspect</em> como <em>--inspect-brk</em> necesitan información adicional para funcionar desde un contenedor Docker. La configuración predeterminada no permite conectarse de forma remota, por eso hay que configurar una IP y un puerto para tener acceso remoto. En este caso lo conseguimos agregando los valores <code class=\"language-text\">=0.0.0.0:9229</code> para permitir el acceso desde cualquier interface de red por el puerto 9229.</p>\n<blockquote>\n<p>⚠ Será necesario cerrar la ventana de DevTools de chrome y volver a abrir el enlace de la página <em>chrome://inspect</em> cada vez que realices un cambio en el código. Recuerda que chrome necesita tiempo para volver a conectarse al debugger y cargar las herramientas de desarrollo con la nueva versión de tu código.</p>\n</blockquote>\n<h2>Alerta de seguridad</h2>\n<p>Aunque puede ser una herramienta muy útil, el modo de debugger no es una opción segura para ser usada en ambientes de producción. La recomendación oficial es que esta característica se mantenga desactivada mientras nuestra aplicación está siendo usada por usuarios reales en un ambiente de instalación real.</p>\n<h2>Conclusión</h2>\n<p>Esta es una forma rápida de configurar tu ambiente de desarrollo para ejecutar el debugger para una aplicación hecha con Node y ejecutada desde un contenedor Docker usando las herramientas de desarrollador del navegador chrome.</p>\n<p>En otra ocasión mostraré como usar el debugger desde otros clientes como por ejemplo desde Visual Studio Code.</p>\n<p>Hasta la próxima 👋.</p>","frontmatter":{"title":"Ejecutar el debugger de node con chrome","date":"2020-02-01","slug":"ejecutar-debugger-de-node-con-chrome","language":"es","tags":["javascript","node","tip"],"cover":[{"publicURL":""}],"imageShare":{"publicURL":"http://doma.in"}}}},"pageContext":{"slug":"ejecutar-debugger-de-node-con-chrome","previous":{"fileAbsolutePath":"/usr/src/app/content/posts/2019-06-12-instalacion-minima-de-babel-7.md","frontmatter":{"title":"Instalación mínima de Babel 7","slug":"instalacion-minima-de-babel-7","tags":["javascript","babel"],"language":null}},"next":{"fileAbsolutePath":"/usr/src/app/content/posts/2020-02-03-instala-neo4j-con-docker.md","frontmatter":{"title":"Instala neo4j con docker","slug":"instala-neo4j-con-docker","tags":["Docker","Bases de datos","neo4j"],"language":"es"}}}}}